#!/usr/bin/env python
# -*- coding: utf-8 -*-
import json
import logging
import sys
import time
import re

import execjs
import urllib3
from urllib.parse import *
import requests
import random
import datetime
from lxml.html import etree
sys.path.append('../../PhaseTwo')
sys.path.append('../../..')
sys.path.append('../../../..')
from bid_tools.loghandler import getLogger
# from bid_conf.conf_2 import parse_dict
# from bid_2 import Bid
from bid_5 import Bid5
from bid_conf.conf_5 import parse_dict
urllib3.disable_warnings()
from playwright.sync_api import sync_playwright
from bid_tools import utils
import jsonpath


class BidZGDZ(Bid5):
    def __init__(self, debug=True):
        Bid5.__init__(self, debug)
        self.log = getLogger(self.__class__.__name__, console_out=True, level="debug")
        self.user_agent_list = ["Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1", "Mozilla/5.0 (X11; CrOS i686 2268.111.0) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1092.0 Safari/536.6", "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1090.0 Safari/536.6", "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/19.77.34.5 Safari/537.1", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.9 Safari/536.5", "Mozilla/5.0 (Windows NT 6.0) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.36 Safari/536.5", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3", "Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_0) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3", "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3", "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3", "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3", "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.0 Safari/536.3", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24", "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24"]
        self.headers = {}
        self.keyword = ""
        self.exit_flag = False
        self.exit_counts = 0
        self.file_name = '元博网-最新中标'
        self.parse_dict = parse_dict.get(self.file_name)

    def run(self, keyword):
        TIMEOUT = 60
        self.keyword = keyword
        url_base = 'https://www.chinabidding.cn/public/2020/html/zbcglist.html'
        self.headers = {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
            'Accept-Encoding': 'gzip, deflate, br',
            'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
            'Connection': 'keep-alive',
            'Cookie': '53gid2=12259327787007; 53uvid=1; onliner_zdfq72221204=0; visitor_type=old; 53gid0=12259327787007; 53gid1=12259327787007; gr_user_id=4ad3d1fb-d1d3-47b3-a672-78aa3cf1e9d7; Hm_lvt_ebcee0764883fb81bcdd54df18970c94=1686832234; browser_id=-1621326260; 53revisit=1686832249935; 53kf_72221204_from_host=www.chinabidding.cn; 53kf_72221204_keyword=https%3A%2F%2Fwww.chinabidding.cn%2F%3Futm_term%3D%25E5%2585%2583%25E5%258D%259A%25E7%25BD%2591%26utm_source%3Dso.pc%26utm_campaign%3D42704430%26utm_content%3D707217345%26utm_keyid%3D54505029031%26ggw_id%3D2102; uuid_53kf_72221204=2f8e4583dcba70ba31f2fbab1b64b724; 53kf_72221204_land_page=https%253A%252F%252Fwww.chinabidding.cn%252Fsk%252Fhuodian%252F; kf_72221204_land_page_ok=1; my_acc_reauto_time=1686832333939; invite_53kf_totalnum_7=9; pop_status=1; b5897e326c6777f3_gr_last_sent_cs1=569519; b5897e326c6777f3_gr_session_id=03841276-94c7-43bd-99d7-57d8e14d5307; b5897e326c6777f3_gr_last_sent_sid_with_cs1=03841276-94c7-43bd-99d7-57d8e14d5307; b5897e326c6777f3_gr_session_id_sent_vst=03841276-94c7-43bd-99d7-57d8e14d5307; acw_tc=7b39758316893278426722723efacaf0c6f3c942c6956b4f67169f0d6a927f; b5897e326c6777f3_gr_cs1=569519; CBL_SESSION=0ec0edff92774957e5134d05c6259be67e96d617-___TS=1725328246368&___ID=74040369-d6fd-46c6-9d5a-7e6d3d9c6ea9; Hm_lpvt_ebcee0764883fb81bcdd54df18970c94=1689328247',
            'Host': 'www.chinabidding.cn',
            'Referer': 'https://www.chinabidding.cn/sk/gaosugonglu/1.html',
            'Sec-Ch-Ua': '"Not.A/Brand";v="8", "Chromium";v="114", "Microsoft Edge";v="114"',
            'Sec-Ch-Ua-Mobile': '?0',
            'Sec-Ch-Ua-Platform': '"Windows"',
            'Sec-Fetch-Dest': 'document',
            'Sec-Fetch-Mode': 'navigate',
            'Sec-Fetch-Site': 'same-origin',
            'Sec-Fetch-User': '?1',
            'Upgrade-Insecure-Requests': '1',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.58'
        }
        with sync_playwright() as playwright:
            browser = playwright.firefox.launch(headless=False)
            # page = browser.new_page()
            context = browser.new_context(storage_state="auth/state.json")
            # context = browser.new_context()
            page = context.new_page()
            url = url_base
            count = 0
            while count < 3:
                try:
                    page.goto(url)
                    page.wait_for_load_state("networkidle")
                    break
                except Exception as e:
                    count += 1
                    pass
            # page.get_by_role("heading", name="建筑工程>", exact=True).get_by_role("link", name="建筑工程").click()
            time.sleep(3)
            page.get_by_text("最新中标").click()
            for page_count in range(10000):
                content = page.content()
                self.list_parse(content, url)

                page.get_by_role("link", name="下一页").click()
                time.sleep(2)
        self.log.info("{} 数据采集完毕！".format(self.file_name))

    def list_parse(self, maincontent, url):
        main_html = etree.HTML(maincontent)
        items = main_html.xpath('//div[@class="content"]/ul/li')
        for item in items:
            if self.exit_flag:
                return
            href_text = item.xpath('string(./@onclick)')
            href = utils.re_find_one("goNew\('(.*?)',", href_text)
            if href:
                detail_url = urljoin(url, href)
                title = item.xpath('string(//h5/@title)')
            else:
                continue
            tenderer = ''
            bidder = ''
            bid_price = ''
            bid_agency_tel = ''
            bid_agency = ''
            bid_status = ''
            if 'fid' not in detail_url:
                detail_content = self.req(url=detail_url, headers=self.headers)
                if not detail_content or detail_content == 404 or detail_content == 400:
                    self.log.error("{} no detail_content".format(detail_url))
                    continue
                source_code = detail_content
                detail_content = re.sub("<script[\s\S]*?/script>", "", detail_content, flags=re.I)
                detail_content = re.sub("<style[\s\S]*?/style>", "", detail_content, flags=re.I)
                html1 = etree.HTML(detail_content.replace('</p>', '\n</p>'))
                content_text1 = html1.xpath('string(//*[@id="content"]|//div[@id="infoDescription"])')
            else:
                fid = utils.re_find_one('fid=(.*?)@', str(detail_url) + '@')
                json_url = 'https://www.chinabidding.cn/agency.info.Detail/show?fid=' + str(fid)
                detail_content = self.req(url=json_url, rsp_type='json', headers=self.headers)
                source_code = detail_content
                # publish_time = detail_content['c_info']['info']['FPublishTime']
                # entry_name = detail_content['c_info']['info']['FTitle']
                tenderer = detail_content['c_info']['info']['FBidder']
                bid_agency_tel = detail_content['c_info']['info']['FMobile']
                try:
                    bid_agency = detail_content['c_info']['info']['FBiddingAgency']
                except:
                    bid_agency = ''
                bid_status = detail_content['c_info']['purchase']
                if bid_status == []:
                    bid_status = '招标中'
                else:
                    bid_status = '已开标'
                try:
                    bidder = ','.join(jsonpath.jsonpath(detail_content['c_info']['purchase'], '$..FTitle'))
                except:
                    bidder = detail_content['c_info']['purchase']
                try:
                    bid_price = str(detail_content['c_info']['purchase'][0]['FAmount']).strip() + str(
                        detail_content['c_info']['purchase'][0]['FUnit'])
                except:
                    try:
                        bid_price = str(detail_content['c_info']['purchase'][1]['FAmount']) + str(
                            detail_content['c_info']['purchase'][1]['FUnit'])
                    except:
                        bid_price = ''
                detail_content = detail_content['c_info']['content']
                html1 = etree.HTML(detail_content.replace('</p>', '\n</p>'))
                content_text1 = html1.xpath('string(//*)')
            data = {}
            data['project_title'] = str(title).strip()
            data['publish_time'] = item.xpath('string(.//span[@class="date"]/em)')
            data['content'] = content_text1.strip()
            # data['source_code'] = str(source_code).strip()
            # 一级指标
            primary_indicators = main_html.xpath('string(//div[@class="sort1 cl"]/ul/li/a[@class="active"])')
            # 二级指标
            try:
                secondary_indicators = re.findall('采购与招标网</a>([\s\S]*?)<a', detail_content)[0]
            except:
                secondary_indicators = ''
            data['primary_indicators'] = primary_indicators
            data['secondary_indicators'] = secondary_indicators
            if tenderer:
                data['tenderer'] = str(tenderer).strip()
            if bidder:
                data['bidder'] = str(bidder).strip()
            if bid_price:
                data['bid_price'] = str(bid_price).strip()
            if bid_agency:
                data['bid_agency'] = str(bid_agency).strip()
            if bid_status:
                data['bid_status'] = str(bid_status).strip()
            if bid_agency_tel:
                data['bid_agency_tel'] = str(bid_agency_tel).strip()
            
            self.detail_parse(detail_content, detail_url, data)

            # 字段
            uuid = 'uuid'  # 唯一业务id，对url做md5取值
            url = 'url'  # 链接
            title = '标题'  # 标题
            publish_time = '时间'  # 发布时间
            area = '地区'  # 地区
            content = '正文'  # 正文
            announcement = '招标公告名'  # 招标公告名
            bid_time = '招标时间'  # 招标时间
            bid_condition = '招标条件'  # 招标条件
            entry_name = '项目名称'  # 项目名称
            construction_location = '建设地点'  # 建设地点
            construction_scale = '建设项目规模'  # 建设项目规模
            bid_control_price = '项目招标控制价'  # 项目招标控制价
            planned_duration = '计划工期'  # 计划工期
            bid_section = '标段划分'  # 标段划分
            bid_scope = '招标范围'  # 招标范围
            bid_qualification_reqirement = '投标人资格要求'  # 投标人资格要求
            bid_documents_collection = '招标文件的领取'  # 招标文件的领取
            bid_submission = '投标文件的递交'  # 投标文件的递交
            publish_announcements_media = '发布公告的媒介'  # 发布公告的媒介
            other_requirements = '其他要求或说明'  # 其他要求或说明
            tenderer = '招标人'  # 招标人
            tenderer_tel = '招标人联系方式'  # 招标人联系方式
            bid_agency = '招标代理'  # 招标代理
            bid_agency_tel = '招标代理联系方式'  # 招标代理联系方式
            bid_status = '招标状态'  # 招标状态
            bid_result = '中标结果'  # 中标结果
            bidder = '中标单位'  # 中标单位
            bid_price = '中标价'  # 中标价
            primary_indicators = '一级指标'
            secondary_indicators = '二级指标'
            source_code = '源码'


if __name__ == '__main__':
    params = {
        "proxy_flag": False,
        "query_time": "",
        "MainKeys": [
            ""
            # "计量", "校准", "检定", "标物", "标准物质", "设备维保", "搬迁", "放射", "医疗", "实验室", "检测", "标定", "检验", "水", "生态", "污", "碳", "废", "声", "农", "排", "土", "气"
        ],
        # "time_sleep": (2, 5)
    }
    keyword = ''
    s = 'DCF469E53E93C4C4072018C2E5A31B285B62699A79D97265788E10C7ABBAAC5D9126266B5A211F4D53D7D69751A52A8D155598DB0844DADFC46F17BCD6987C02D46DCB9B1B94E72AB973D85E16334B281D4AA4534FF8419EE5520F8BF305553BAA8D911A147A9764A42D9548019212B500239B50615B4094EDF3D2289F2176B128D887AABE21DEB21FB84BCE8BDDA520F4CEF18C9D8888EFB15A7D31F3DDFED2AAA791C30A0710ABB11CD20B03F96E7B362A1F56C2A88C1BD3DD9751B80B7803ED9F5804D6DE23E7FEA7CE9F0A80D7FF40E2C0EE3E2EBC21DE9FE1F36958FA3E2CD3F4A651FFF419682EC617194C8421C48A5F8D62AC60218112F6442B049DFF1297B58D74DA45817687714C0AFA114E90D3645E3558B579360404B8DE956DAD00E5D856102390A60D15504F52435CEBC727F31645667A91C69FF75602167CE0B9F5208880AA5C5F6F09088D208C5F1DB6E291E4712994561A253AF925849D2F185F9664CAEF4E0F9E8D21D9ED4C5BC1AF3BA9FF144A7790E4B6BCE647F0B45B1287BCBA9DA5E1F5471988A2251F86AC8C0181D4B4C39EFD85DADFD73F05BA79A44897EF927B2348821F6646B3F5DFB467D96369B03B2DAB63D2BED3F8D55EBE2478908ADD9AAF240C9F344A6B1C8D933C296C2951AF56E4DE18E209FAF6C9FAE8EC8B1747970205995AB5062363A327A18FD23DD38CB3E1803E61C2AE3BDE2FEDD10E408B4F83EDD898872903CD58A0FE662A891E6AC0AE46F7A5838F486A2252CA4903BB27BEE160C11C09443180081EBFAD7E23D1E7E491A4E525675AACDE95602D0B1144DA78C6B2DEF8E5CDAC7FCB68E70102C2013684FF8DB22D8BFEA301D1402F40A8755189864F6E13137E0168DFF4403FA7870F954ABE3639D883CA73402234AA35FAD0F85305C215A79315373429AE58A4C584A21D9DAE41E5647EF0B81BF2FEFF8EC3C87F3885EFF906F6612A94E4823F9CA01077E5D95400454339E3EA0353DCC58167939B36F4B6A99307FD29A240C6FD5E936C6F5ABE7B3C2222C081DE24FDB75A112786C2ED0F7890FF466932CB345672C943F94F0145BFF0DACA6B79DE458638556C9BE5A0A11AEA2820F19A728EEB7B48517FE2B73E93FEAAD88F5F34C3983841F4B1059F46F949209BE578BF619C2AA5C5F094ED4F9BAB1068DD57A98C0F95EDDBDF37A56651FC8E1AEB11C3CB88F754EC52E6E21A67F3FCAB208833EE7BEA82977DCBD4E4B7C858CDE1D276500918C47D10F4D826A742505AA4F50EF72100DE0DECE5B82EDAB9112B6C02949E7D699C04342DA6CF3F7CDEF834BEF958CA5F8EF3006D31EC6FC9ACEBA73E2BDCA6241E2954CC1FD93D839363DF4700AD2B8AFC29036508C387F26B308547BBF1816E7DF6E5CEC195127F8EFF1B61E522C58643C313582567D102D579AA0B6652649D29ABABDA6C923D9F0132917A7E906872007B188447E7EBC4C0AF2832122F6E6FCB3453DAC801DFF97CFB43785CBB9164AF2D906BECA5A0137B16973058587C866CC3C90B3B50D150EA931F409FEEF0CB322C0DC370805E6C2C04DCC494B9AE81D776B874A93E37115869F7E349C29EC470AE4D1E0556C23586F68D440F4597B24AF549C8CA985B45C206874F09B5F7FEAB629F16CE32A4A42EDC904EF5A76BEF082C88817DFFC3D1A397CF71926D167415B87B8E287DD88FB8AEF650FAE45433619E2677679CFFA4B7533F303D30DAA0B798CC92989E1D042426DB309DD68CE23FC4B502CECAB8F49679A537D94F00E92191CBDF31316167A0FB21A73508876A30BF38780954B79E4B9C5837CBBB2FCF89DB27151991E700CB4520596B60007EF19CB5CC414E94C1C8CB50F274E4DD34E8AB61729E5FF598AF4B2316FC1FA96F3C0DD00041BCF770D4C70F6E056D838E6DC04FE92745042E6AF7E12DA7DA9278920CA7818528AA88146A231B914391CD298F6E0409889D84E2DCB123F4AED8B06CA2FED31EFB1F6CD0E845112DB0C0D8CFDFF69CFFDC325ADC8CFB614B62639AE1732F8EA9110A7883EF3013FCAD81ADEFAC6056FB1AC2AB6117C7C1C5345C4EE1CC43CE36E525578D71A46EEDB218C564E0BA483321AF6BC4D3AF459D38AE35B519D6970195F76A6BE8AF4E42269EB5100E8D4275F7FA8351002A5139DB01737B248E7172A8928A208A56FD588E4826812BB9C3A9767EFDE824371A46AF6665A8B651CDD53A6A1E31BB6496024AFB6F01B2E5E110C2CD526D5C367166E8E8BF770C22494BD704A78F7136169015FA81142429E4EA606709C799E41ECB189835C08B893022F886E217E46D1EE81E47FE1E5D239B3F710A9BA4E9F8604D07E35FF9229759E594723B11E8E7AD96F9D44EFCE94FF4C1AFE81817C61B4515793F9565CBBD188E337962C865EAC52C07018C54EECD2837433C1D788DE69D8A6DFAAC576D179F604A77338515851AB78C4A0234C1A8DB6DFD4BE4A529CEFAEAE98AF595C11328AACB636D10E9F221DB1A36C8769ECF92E1A88010E256BBF38FCDBFF8FF440EDCD696F1CCEF6A5540A401C641611DC8DB14F6A4F5BF530165695998EEEC735BA86BDE1238A2559B91FA00F29C65D4A0FB8B572FFDA8D86FD70D418DA06DE2627255AAD57DE31AA5277F4DF5B690282DBCAFD537174D9D8A34B16ABCF6A77AC2B48A07392218060F183AF5FE31CF65764D54966608B2C9251602B957178C438CE3303C09C0D651B1CEFD9B6F4369799152F4CA7EF78B19500421DA26D089B38A1A08035F4643C887D0F641C6329A54289F1A57EA42C4909FC8785AA4DF68C898BA78FCEE5821546445BCB7C066BB6FF0241ECA792924264893A85C424964A54351D72960233B1A5C865A0F9B81504FDC9BC3BB3B210807B6F544AF613A450C7DD684DAB196B50CB1D32CEF95B573CCE1ABA9149746D0B268A28B02A40C9A0BDE58A0045F70A1CA4D0B4DEBD44637B5E8CD5D0C0C9905AE52EEB3AB2641ECF8B3678864F002A173C48778415C354EB7CDBC60F9DAE914189AD6DE318F0C2E87E7AD023F6184AE16BA2AEDD0D352EF317C9023C9EDB7DE9487E843B887EC0551AEA51431ACDA8BAF1A9A9FBEBA7876320CD11DE09366D97EE470F4FCDA3FE3B92BA52FE0557DF0C9F0744015403B23F84A97DAC656DFA281D16387EB0B6F22C9567D698AC83D58F09FF1A06A1D681AAF93BDAB7A04E7F13B2D76C9F0B11686773026FEF2102CD7726902C2A1B110B6D08F4C8E76B0570DEDF695CFE07B4ECD435E2FDB2B3A987263B1734E61E2D28E9D648142DEF4C3E8FD15D585B2DF808D59169851A0483AAB06223BE63EF9958E01F89A9A77FDA6533CF144C553C224E41DE1216A804621CE7D36FE446252441CDF3D106CB651AB11E8D936F9157141664476C06ADE3F40D0F3EC9B7F782E914703A392996306620F4F85C6256262925DF5C457CD9AEBA497A3B37FF217E49C2FD7DB8684F02DC5EDFC40906B5835B671DD44EB38C944B14FBB35F8A2025462E737CB4655BDBDB42A08C95DB1931981E95D153C656B861C0DF87F327189A18442DDD3CD2894EDF561C0B9DC8C55790B310C7C179999B590E07CDB9FA1DA96E94F35BE7C4ECD7CFBF72EDAFEF53C4D9B24815D8A49D065F6ABF264F11517D0E7D0F0D5E9505EBAC211BDCF55F2362ECDC31BE84FBB6A1CCA7ADCAE4DA06E654A240B04A72BFB4145B889E5705ED9D0939BCBC3CCB0182656A0911FC8934F3A2196017102A511CF75192E97CC4B0DEA8B0189C286E77CC2B5BD1BF97E0291E3F75EAF896D314FDE2CB1690D24250A7740C3920B21D428F6CCC29EEDC30ED30DB816F77366FD7F9EC550782A5D7CBAC819CA2F3882F5E358EAB80B0EA7771B6D72DD1140C8FDCA86E2D6F0E4437DA12FD4439DA3D75A4355E71585EBAA639B4ED22428C95186DE124B48FEFC9FF4AE47B41BB2C2DC7BA1033C3BEEC7FFF758A81B075E60A79D8BAE71A4753D5CD6B3183314901438C2C7CDD01CC396DE7CE15E4AEDD647DC30A90F05DABADECB86D29A57DC44976C25747038EC84B4E270F28C52F7BA4C496E3BE7EBC7947DB0B12D2739F5C0191DC82A93C92E205A0651C85F289198E9D7CF16F4007A81C8A9A221379EDE3B493D0F6602FD514752F6D83B29C6F9EF81995D1B2EBB4301D88AA4774AAC2A548748C4549C4B73213C78D46A5680A14FAC013A9044C28640CBFA31507B15B3A37FAA54193C06A1BCE6F4F72C0C615EC1E08E303EE0B31E8C821C153DE37D570A842A50CEF9E17F43924C2583E634262DABFC39BC618CFE070429E3DD91FD08A16E58CE3EA1502D0DB6366AA07A46B76F4F444BAB33B1747137162AFC21DE92B3EA42597EC9F7B6563F62868E173D06598B949FAA708B65697B44E8B22FEF8739AAF1FFB4DFD317506EB5E8503063FC96050F96A9269884F4C5CB3FDE45087EF771D81A43F46740B93A55A4C6D979307857C5418828FD56549854472CFFE1AE04EC9085B31E3B7E62A824BEE5DAB4CDFE93420925DFAEEEE04B9C3F31AE262B7010EC771C9B6D5D84CC33E0FD8C46364CDEF1FF0A12E87AF73808BFE1DCF43F2B1110D7279AA261A0A2B553C6DA6BFF4F76534251A5153EEADF554F36989F835A269CA15A2947D50FFE1D88A3D2D1B426839BC51E75034BC3B080BF59EEB86965BDE718788B17E486FF8BD6118C2F7EDF402CD70BD84D759AACACBBB99D54846CE9708A6CEFC4947675C4EE4C77F23D3637E4CC3854EFA2A232867D5F36FA04EFB18CE99ADE749045869678433339D90B50F32675F7AB07EFC3B702C2522EF99B1E3B308D154E62F9B0346AE45F9DDE5DF3BDD22CAECDE3C850E20A97D53630E20CDD1F1771C05B0FCD9163F7F9D762EA30CD78F8EA7C4788AB1661DF7E3121C9385CD34858699CCF87FDFAB576E69CAC4DFED621DCA3724D16F6A6A7877C9733F6E49D6CA087288E3A3FE9455B1E2897AE0827C9A5A0870C0F7A1E9D753F1E4D092C398D28EB4E05B29803E52644FCD284CCA785DF53E695E6EC9F762C81E076AB16AF0844BA22F400147AE7FD5C0687F9E1CDB8CDA903D738CBDE250C3749A2B77255EA610BDDBFEF2A2BFACABB7650F0F04C03C29FB5841379664D3A1E47808590ECA9907874CB5C00A6AE32A26E94F8CAAA64B197ED62D0667B77935A76927EFFF379266EEC074FB626FBC626B7863194A8C77B58E4A45A4E1CF5E5101D10339EB4165CB9614344896245FE66617B22AD67B04E7924C6B0EFCCD26B62B6F28F13662F3CF7D16A0F49FC8E2A3CAB4FDF6EB5EE6DB667100781699B8C21A6D0935F44C8AF74A29683AFCB9CC3833959E6C4D7D40EA65047BC7C4809765394AABF2F9156939EB8D0BC24A8D784C3A83CAC464625A21E94B07FB47D0A7D5FAB3BE475623C1B69559169C62A5D952F807F8458CF3CD548EA693134216D5BE575D8B07609F469EFB59F696F26EF5BCFFDA7174FB4BF6F2A9070B0AB8AF1B689DAB29A4A4D9E0AA49AB1B16BB16E71B789D9D673213E23C506BF9BA659F8C4802F2B3F05979A92B88CAD437E70455FB5BB02F0FF96B06822C03DC3B0E863E1A3FF2870762753DCA9C234059AD34F5290DB64C608AA6147AC1E4F9921FD4EA3F1EE19D4421C0E8FFCB4534E574C169830E60F6715229F0203B790DD9193A8262CC89682B036DFC395284489326C475EEB80E89A1D82EEEA6283D7380C6D97EFF3A0C994CD043A1E38DCE299671EBEA46736F87C415D44512123FC4C9ECA4C453FAB71D63BC750BA93BD640587D1580209BE165BDC99C3532EB0740B07CAC5B70095C8DBFB5BD02B50E205B5349317945F75405E21125AC3D40FB1DA6F3C0F7A334CBECC66101341A93EC99F65DF62B0FE825A7D6F3D7BD924BBD6DA50CBE2AAE5D1E4AD91A972CAEFBBC9118497B401BCD419E03EB16DA4DB1D0F305E638B0C9A6EAB09446EF165E0AB1B0AF7F9AC85A7C2DBE3158CBAECD297C520C54655F19783E5DBD99031EDC1FE86687F43D0F94E3254539363056476C3E37A503A2B9D3A798966331C2B9056CA0C145CFBED3BC72FB6CAABAF970364E2C4077E917C09BE5C4F4EBECFCE7727407DE340BE416B5AE6A1B3DF3A4C521669FEA087E361835836C085B6C50B09A7161BCD80361C99516586091069C14803423C8BBA36871037266C80307CF213183E390FE8A784866DD6028A544DE7E90CE934E2C206CC1C790C2B84A71B26AAB21D166AAF70B0662A099291D80B9826D46EB94DC3F6DA03244C1AD3BBEFD6148C7CD252B1DDBE07DAFABBFAD013C94C18709766C58CA8FE8CC84EEBE6EC1B2329CDE3DA2DB10552B7131D358F395A45415DD2D66C11DF2137BBD978D592354B3101171F27CF632E6C5135C717F50817CB1E36D47790B186CCA0633BFF972B87A5EA97DEB539CC190BD8BF8C5E3F47208007E54A46B8C461113C23AB96C8F754C650F7034238F2E03E66226C8415E1EDCAAFC2D31B36988057BCCA822CD00E6733F37D716E175EF8490FDF02C8513303560D6A376831B49AB3806DD4DC5B98EA7C353926C0F12D250317740E49C4D1FF238FA1F6687472AD01F6314889F591EB75847DD8403AED71F73E5B68948DE36588E8BD4F4172957D4EBFA5B23E253EC4B1C325E9D3EBBD1F5B98753E3C7768AC0750902F64B0582566BE50FA5BF7439605E534E43098E46304E358B4CA22DC1FC4FD8B678CB4FDBFF942BEDFC14D77304F9BF6D13381017FB9B8ACDFA074085A1EB49DF82E3C2A563B8F33039D6B9BB925B00539CA463F207546218A08F50B9D8A17FFE07420C9EBBD3AB7B5C535BB22FD894E5696E323224C2F709B8C2C8C932F9D22CE1EC0891C04AF30792CD1C92CEBFCBA1035ED98B527BE22F76D9DA25CAA0ACAD3919A1EAFEC4C70D01C943F4FD76D7B72EA7816ADB06FEEEA1D6DCEE137FD08102332019540DD981B722010DCA817A897AE32E959CE6CD30C22F8A7B846554CD307A3D7D444F2ED68CDD7172435597082EC919714AE8068947880079A0AA9C732F4C25EFECFFD476D8C2A61C39D0978471DCC530084421D755A04BC539117BE1A2B38E4B261DBD84EF921BE833E91292E5A179C1E0A0C4253565D90E7B8591C4990007F08F2ED43C2F010EBF2B3AFB3F3825E97B43EE2257FC160A44A8C97531E3BB2D4531D24A3B7490BBA8BB7345C07DFAD3B02BF931209BCAA2677A3E68E02D1FF210877F86570C312BF6DEFB4D484F21A8EC9D4D3A30FCB312D33B2669655814928882FD9B853214295370F22F55558D33C684C01FAB1C72F217643B5B313BE4E7122EEB44B3DC1584B2967A2D04776F4828915278AF9E25F89D3C7C23581837FE833CF782FF7396E9BC9D1145D56606AB0FB4245C425798EF422362474472A25BBE57E78916796E31CF006B5CDA65FB183862CA01FB9FDB0FEF2D7A08EAB64EFA1302389A313B2C962A213BF2F473ED8F5C0B416FB2A568218A792BD2F6FCD0B2692397C881A125CC1F6331070765FAB56BE4CAB86C71064B8B2FBA7220530E50686C760FD883497E4CD3A172291D15AF7ECC005F6C408C16FCD524FB4FD8A0EE189272DC1FBE1D1E76BF7E5222E184763111638F57EC64F234D3FEE8F12386484FAE51BE99EDBF9A8157D3C72FBFAA2D984A235290673B586FCBB6D366F23F6FF5DD7C517EAB55BFE486C54F8F1AD0675F9E0C56E3F784625EFB6494D78BE2AACBC0D5F0F60B26D0F21BF28B754B03EE5EE95AFD9F51B19BA709D1AE3C0E437A48A4D030EEC26DD44683D578FE0A0BA6FCE842BB4670734DB59938584463CA8BE20E024104D59C95EFFC482C355B5C211990C9E2EFF82055B3E13DEB9FFB5A07CCD4E3E0618ECE28461A627394EB94F7112C370014DE524135EF833C421D0982F6E830A9A771E392E49C038F4196C56D88A576A302FE6A8AA5A992C86E3A3C767E695BE287532696B4E248990FD3A8B36346270090A7273F270EE9E186D1B9D0D47DA7E826D1DD176570FEB2AAB0FD31642CE6BAAD9B958F2123E8D3EF0DC88E201EA24B383C4804FC4B8BBEDD678B9EEEC71E2A780E670D6FA599D1094E904D263E964120B9BAA5098D6F0584B887784E10237C95279A30B5C310F70E6E2780EAD207ED324078155A2862D8C517FB98161F15A27467F479956C17C15CA5580088D23EE7D0341BB3C206B7358CAC7F28E0FC8C5EE6E7E53B66467E569F24E774C917A1A076463B4DB6840261FB5C8C4B47720C057FEF43170AF38DFC2621F8C2BD0029C273EDA969F47359B7D489A708F1504E915C011AF6AAA5113465A06DAC5DA50CE8C0608BB890D6D2E21A8E675AB19E18519F7E803E112BA57E01BD188F5E366E3AC4C5C17359911BB3D3B059976E62A1A6DAECDA24BD057C5FEB818A9FB4A8062E2567338A0ED1988D3894B43C2F8CB155AA93AE427EC9E32F9FF2E4B6F06CDC4C4ADF8FC1471E234A79D9889D3704EA8E5B27B61D685EDD78BBA0562AFEAB970CF7153F32907EEE3888A68EA92FF5DB0544D23937B6A10DE5F53C1410AF9ED86B2CCD77257A8B984CE53D51B6F7ED3998F34F27B2D6B2CCF38E9B3C4A6326D3C97132309DA7C38A44782C275CDCD126C190152253A24A3A99FC683C87F14C02953F27F83AC8315A63F64A430E81DFC680D096A2C175DDECD348879A388A437AE9FB9BE70DE632448AA74D423E0F5BD963443F46D14D45FE6F41EA8D32D9F7A1375A4922408DC557D52CEDF32C49BDB8A4209AF72A1CFC8B6D4DA5E938E28D1B9740E4BFDD8259431EF5D5BEB337349991819441660771274DBCDADF56EE50BA2FAF29CF1A3A9BFD7740F09859653202A225711A9D07FC29BFEC1BB00E813C143D4A99ACA8A09E5C71EB3BECCDE37BCD50C39371DFADADC0524F499B46A463B7FFC67333F9BDC4C2F3FEE0E06CBFA7A805BC71C70F69984FF25B55508AD77B473DFA565228DAFBF3BDFC42230F295BA4E09338C62500E1F8226E3D393F301B786EF02ED753CCEF93ED2A5580697934C6D59A2EAADC49C4A57C19A139C4D7724A7F95BC58B1114C882F9A9B165F22DA138266266D95FE0FED8B3D95265976F26D343F05CF941CC78D68F2DCDE3B63558CC2AC794C65C1A95C9EDEDF98F1583BAB011C5DFF6187703B425C53D7F39A52680306D6A9F11BC359C7ADBA0D53068DA52C6D677A2E1749D87F6063DF146BF2DB921A0B6B2196F15CDF62B36BA54AA7A9D7BF867B336A6F1BE30AC87E6E66CCEF0D43CF417323E18329E6DE5FB4F0FEB815045389BDB2F9D9C812EC7577B355EDE2A861935E655DCCE105863A96CC957EB39A41BA189D8E01494677F3AAE206C30E06348425EDFAAE82517D8A4E8263972100F96C74F91E58BF07FADB3E309C83F72B7C526C0DDE56D71886ABEFA599E9D7A98BB1AB392631612D960F1A8756B0E4A6F7ABA8398FC03EA86FA5A0D7FC8D04EB00781A5CF8C350D811F5EB47ABA41E2DFC86A8EBC1C5C744B465EACF4721117160143D0080B2DC5B7586B327412B3455DBFEE5327FB42E9C55A95B5DB1AE25690A92EDB22742C56862F6BDCC2938379B187922225F85EC84F42A52942FBBC443EF5BDAF36CA93AC5B69DB7F88612FC94739CF0D1A5EF513B99318AB6F684B0D7ADD518FB380578A514D9363A62470FBB8331B4E49CAEF720EB0BCB0A56183F6AA99FCD798AB912FBD2DEC07AEDAA189F2B725E8278ECCDA6A6F284FB855863167CA071AAE27872FD577FF12FA05BAE2BDC844417D3968BF733F66868F2B799A2E2DD1F42F35FBA4B70940760E26D9402C9FE697B93C4EE0510FF85505CD76F763946B50C4FD607FDE9705FD292DD9CFDD65EFDFFE1144F8AAF1536FD21092EF7ACA76CF54D553EC82BA9F41575AD8A1E6F444BD760985DF28BD2C34859F8FDC1CF8DE6546CA5E8C4F24CAB46DFE58A2BBF7E3D9F299458F658E1D7736C0BD52825C92AE47EDE75BCC39848614ECBC33D29D4FF0C6D628F1DFF966C30D4D8B72CF18E71D5E815341401846A392D57A228FD203756DA343CE8BA200617A91173F9D8193CE435C4C2DEED42EED6EF76E4EC9FF3EDA9991811493DDA82A1A662AFC7A75A09296950142D9BBA064BF13E89EAD78AB1CD3BF4C7C92D47E565EC45869997C1437CC921CC61221A643528EB2FC54133C8070709105414D66D74A7A4BBF9D2CE2760B3DF90EEC68B959027F5510319FEA3376616140EB2A0FF5CE8F8BE79621D19BFD39CEB4FD1A44815516DA9B124593EDBA71D4E90E5AA93C0581801C0C3D530C94E2B272A4E8AEDB9A9A9EC6D6B2472B0B05B3B12702EF4F689171BD440ACFAE20EE986D6F8E73EF33DDDC39D724833696A6D9D8A954E356BF9E58A50448D614168D18A837AC17133A4ECEA7C7C79F20A0FD323AE292A817C2DB57E4A7B09DA69B19A12646872DA3FC70BCFB5258781C08F3E485B8FC4E32762BA3AB5C82451C3BC050373F30F4CCFB47D3C554A87808C8376B11F89623187BCCCC8004A0A124288F32A1635C14B3AA0DC334278460CAF4440793435EF6B787DAEA8B79AD641724A6E95CB17D5BEDBC1DE2630A611B9254666225E0DA085AC6755DF6498A3B71B12EB4B5B74E82968A8BBD7AEC4524B25EBDE65F795D3F53188EA7CC21B1034C0A7319363CC82ECC83E69D0AA9052EB3AF8C27ACF3667392E60814D0EA0BC205337FA139C6A934A682C03B35FDD31CD6EF2C09B84FA72A1B8070257C7E0552CA8706C16C9AA1E038BABD113FD843C0E407F7A8376EF2D241E23B6A27A660E173C3A91103C3981653D36C25A973CD68887B8DE978FF821A4A912E971090353312C3CBEBE59980B6AA28B13165F177D75A8628922EDED310F9043ADA691F992CD01160DE0D4F77BC379D23EE6B2F398C7D05F75FDEC06DB5394E0F3AF2441BC8251D2F18D1B5FA48927B04E0B5D89ABE24C86E56B80AD53874723935BB0237806968931BEC3D58EBEAC50A88DA65ADDE2F51C1FD2E0F6D5E044F72354AE48BC6FDE48A1A3F1EE87FD648F7010AD518EDF293B8C8ED32FB9F859C2C70C5F2C67845DD3C0D8F5B7040C9B7A27920374CAD982F894595BE2DC525AA6168FB4D41C9F6F3617BE23599B083DEB55EDF432FA56481431AF106D528434FD348A933ED7DE800B6F0FC9D8F746D2A0804332B767E09417DE75C27F25C0B0ED6622A40AB788A8E62B5626A356A3B90CBB60B5B33FEF8899E767112253E96A515F7C388F97D21F01AA25918D3F99AA23D52CB191B7036DD62AE98493C9B3637BB759671300BFE0EDC104DC02AD051CB53AD7DB7FE824352DE4344F870D4A39ED2245686CBB7556C2F2E69585DE49D31FA5CB6414F52D32EE8B35D84AB99A6D34BF2B8DF48B1228497BB22A99F11709A2BEA42025E65235D77B1F2E2DB43555E701C836E46DE84EB0DC0AAC673A684BD117129434285CE4EF1E54C68CC3A2AE891A97E1DA53DFA67FF6F69686300A3BF186BDBB007B7128C17058A117D19A58D1E5EE7B41408BE532308249281D325AD1289646A930D704ADE0539949C2F31EF7F2827ACA68360AF91817B18E6FD1A3B3AC19F76C169CAB6EC72F70394089E51B77E1EC4283284177BA495A9BBCDD13E272ECA7758BF787CCB897772499EEB79B4E987177978108C11E443ED8F63B26A56E5285B5551370B6221C4F9C141012C5D93F41CB54C4A00D8A557FA0C44BB6D2429C275890CEB5EFB39F3737F1050DC57CE610D69F34D87BAD8228B0CF8A4A195B87F82905937957B21CB7D1DC5A91E88AECA3ACA788F33D41F0C4B2A1432166DEBC1CE8B10DBC27B68142FE5225673B5F2067E8E246CAB687421A0420589C4A3C3345FF0454EAC00084A24FCD213CD21CDBCDB41BC20021A51434A7578475448125A298E32A9856388600BE205B8ABE9F58E7FB94F09AC30C350753F8AD3F102A4AD296EBAC84CA9FDD1306CE974A54B68E5F1D44307463A970F638760EBCE26AFAB168AA4FE62E26CF391A5F3B34B1E661BDF9967AE60FF85058DF4CB1CA67AEED5E9DDAA2D4ABEC5B9AB6C4FB18A8C5CC8744750D7C392E5735C0F62A53BD8028E0493EE5818A15E052616E68CDF01E703B7E2AD803DFD723C15614270ED5C135218F5B5DC1205CC35475FCEB7CD33206DE2E1AB2767C681248933C2A190B7A4A6ABC97178469AF705C9184AD9C135C50CD43442665D4DD6DF9270188801CC55E763B41803A78B633951C3F7F312C5E3E34EAFB69B2E069B99B42213FA326A72CE39CD9D755F132214075772CE1C8C7D735F8F05967CDD2068A91F7872231B1E5761DFCD9C6D405A99CD8A9EEF41F0E3F3C337406921F2F30AED248BE9D5715C14042E15C0AD2F668A15BD688C7C3E9E7CFD6826788C5D12CDC7148CA01CBF2CA76638A468C5E2D74268017C2603737F98A051957E39CB6FD0E84829ADEBDC21B34AD6DCBEC86FB071A618EA133FDA8D05B5334319D4E7156D57E276A01F7B589FBF60303D2B1837E5B5A1AAEB409A2F7053FA550C251236F6124D0A216BD1872146B23E32834333F628A514364AF7D73AC77DC894DC375EC0E62925C21048E0D77E6EFAFF84DD44E861BC822FA45BAE0AF7E44618BAF62FBB6E618F4683909919FEFDD00204D8FB300759C2B5AD4423C94C27A1F71B122332F8AFB2821240E3B54D94535AF1AEB7D65F6E2771256996993AF2BDB4DB2DDC193685B701F8AECA5CDFE3F2B33EF67C07A7680C872943C3B59632CB1C9767A082807005387D0CF0252D1B4ECB9E0811A021D3FFE7B352429594C586A2F9FB5C5F0034AD5C7F27C383C7B76A70D7886B0EC83DBA0E35A624B9C5B3F6B3890483738BD661EBAF0B98AC740EDB11EDA8F28D92C1208D856CCCB45B9FAE97A6445E4EBE572DB46E1A3CB817B9B55B8984E58E0C2B95665B46732DFB4921697EE72941C67A62A8225CCAE4E9D6A9756D85005FBDF6AE0FAEED53E9EA654A48701B6D6EA349CE482B068790922A24AED9AE6AE41D2C82ABA0FB02DEFFAD505B94B83083836B630B34D5B3CBBA2D04DF940C853112AFB6C06A0A8133330C9D1030BD038E1A933D0D93E0FF77D802CB2578772A335D79CBA42DAFBD1BDF8CFB3516CE9B5CB2B55EF91491AC0E43D680C321CF1444F2159D18B62C39286C6522C6ED21F02513C8D06258AAA8127B728F4F550465A9536CE3DE0326CDCD14661C2526D8F7297C268AEB8A6A9C52AF4FEB248CE77DF0FE47EF0B8A2F0B3D3F3C9B88810FCA3D3A5F4026C50AEA2EC9ED518B2D8B34CC39F64A677C6621D4327B7545133A6094339BDB32577DC83CA8CEA78A0AF629EA882DBAF0A93C71F842EF8353453DC9EF4474FBF773D4FA36BF363F0FE85CCE586B25D6196407C48A443D3C3B257AC870BED592B8807D2BBDC9B0B0FE0BEC71CACBE3EF4723AFDC82B8D65E215543D0C3495D4ECF2FD3608B0FA390B7B845C7DA6399A05FF32E0C3F2721F2BA7B5FB67999FEB393D22FBE048AE0C73BBE723CBB8B4DEB2BEB6BCEC3C756269E973A13453FBAD34BFF4F67010A1C943CEE0FF9298B51CCAB4C958A0C46091855E69EE5F209948FEBBA206523550E9662BDB7E00C667BB3B0ECDA86EE875C96C256169E8A17A245492EAA6AC3C3ABFB92D6375AE7F22B22C2C9E14529F63F5EAE1380405CC89D131F0F51C37C64D13F7FD7341E532C9DC78B5CEE1993CF5AFC3C927615289B245156FA9B0098EA408F3AD992B764FBB81440C5B9B94F003E25CB4D9880FFF923422FCC92633910E4B85F683342C7A23C140FAD050E153741B525E7E649B241A23C7C6CF3BFFC5ADCB7FDC1B193DEA9D1B91A09E72D5CE6588368F7305BD88F09D2B13A5BD08A258369A983C6A8292CC4873DAA0A25F68F996DEE0175EDDBEFB5686AB76FCF6FFB242B45B91A072379538C2EEDDE5BF09F1BEBABF66B'
    js_txt = """
    const CryptoJS = require('crypto-js');
    function convert3(txt) {
    var a = '4b4e31356d6638344c6e61326c3030347361646572364d72',
        b = CryptoJS.enc.Hex.parse("436d396432667338346c3364324e3673");
    a = CryptoJS.enc.Hex.parse(a);
    var txtC = CryptoJS.AES.decrypt(CryptoJS.format.Hex.parse(txt), a, {
        iv: b,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
    })
    var c = CryptoJS.enc.Utf8.stringify(txtC);
    return JSON.parse(c);
}
    """
    ctx1 = execjs.compile(js_txt)
    encrypt_str = ctx1.call('convert3', s)
    from pyDes import des, PAD_PKCS5, ECB
    import base64
    DES_KEY = "81AE6CF8"  # 默认8位密钥
    des_obj = des(DES_KEY, ECB, DES_KEY, padmode=PAD_PKCS5)  # 初始化一个des对象，参数是秘钥，加密方式，偏移， 填充方式
    # des_obj.setKey("enter your key")  # 密钥设置
    secret_bytes = base64.b64decode(s)  # 这里中文要转成字节
    obj = des_obj.decrypt(secret_bytes)  # 用对象的decrypt方法解密
    ss = obj.decode('utf8')
    # ss = encryptByDES
    sss = unquote(ss)
    print(sss)
    bid = BidZGDZ(debug=True)
    bid.process_item(params)
    # BidZGDZ.run(keyword)
